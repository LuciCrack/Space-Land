<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Base 2D â€“ Builder (HTML + SVG + JS)</title>
<style>
  :root{ --cell:64px; --cols:22; --rows:12; --pad:16px; }
  *{ box-sizing:border-box; }
  body{ margin:0; font-family:system-ui,Segoe UI,Roboto,Ubuntu; color:#e5e7eb; background:#0b1220; }
  .app{ display:flex; min-height:100vh; }
  aside{ width:300px; padding:16px; border-right:1px solid #1f2937; background:#0f172a; }
  .title{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  .pill{ font-size:10px; background:#111827; border:1px solid #1f2937; padding:2px 8px; border-radius:999px; }
  .palette{ display:grid; gap:8px; }
  .tile{ display:flex; align-items:center; gap:10px; padding:10px; background:#111827; border:1px solid #1f2937; border-radius:14px; cursor:grab; }
  .tile img{ width:32px; height:32px; object-fit:contain; }
  .meta{ font-size:12px; color:#9ca3af; }
  .actions{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:12px 0; }
  .btn{ padding:10px 12px; border-radius:12px; border:1px solid #1f2937; background:#0b1220; color:#e5e7eb; cursor:pointer; }
  .btn:hover{ background:#111827; }
  .hint{ font-size:12px; color:#9ca3af; margin-top:8px; }
  main{ position:relative; flex:1; }
  svg{ display:block; width:100%; height:100vh; touch-action:none; user-select:none; }
  .ghost{ opacity:.7; pointer-events:none; }
  .badge{ position:absolute; top:8px; right:12px; font-size:12px; background:#111827; border:1px solid #1f2937; padding:4px 8px; border-radius:999px; color:#9ca3af; }
</style>
</head>
<body>
<div class="app">
  <aside>
    <div class="title">
      <h1 style="margin:0;font-size:18px;">MÃ³dulos</h1>
      <span class="pill">arrastrar</span>
    </div>
    <div class="palette" id="palette">
      <!-- ðŸ‘‰ Reemplaza data-src por la ruta a TUS imÃ¡genes (PNG/SVG con fondo transparente). -->
      <div class="tile" data-key="hab" data-label="HÃ¡bitat" data-src="assets/habitat.svg"><img src="assets/habitat.svg"/><div><div>HÃ¡bitat</div><div class="meta">hab</div></div></div>
      <div class="tile" data-key="solar" data-label="Solar" data-src="assets/solar.svg"><img src="assets/solar.svg"/><div><div>Solar</div><div class="meta">solar</div></div></div>
      <div class="tile" data-key="lab" data-label="Laboratorio" data-src="assets/lab.svg"><img src="assets/lab.svg"/><div><div>Laboratorio</div><div class="meta">lab</div></div></div>
      <div class="tile" data-key="comms" data-label="Comms" data-src="assets/comms.svg"><img src="assets/comms.svg"/><div><div>Comms</div><div class="meta">comms</div></div></div>
      <div class="tile" data-key="store" data-label="Bodega" data-src="assets/store.svg"><img src="assets/store.svg"/><div><div>Bodega</div><div class="meta">store</div></div></div>
      <div class="tile" data-key="air" data-label="Airlock" data-src="assets/airlock.svg"><img src="assets/airlock.svg"/><div><div>Airlock</div><div class="meta">air</div></div></div>
    </div>
    <div class="actions">
      <button class="btn" id="clear">Limpiar</button>
      <button class="btn" id="export">Exportar</button>
      <label class="btn" style="text-align:center;cursor:pointer;">Importar
        <input type="file" id="import" accept="application/json" style="display:none;" />
      </label>
      <button class="btn" id="save">Guardar</button>
      <button class="btn" id="load">Cargar</button>
    </div>
    <div class="hint">Suelta sobre celdas libres. Clic para seleccionar; flechas para mover; Supr/Backspace para borrar. Exporta/Importa JSON.</div>
  </aside>
  <main>
    <div class="badge" id="badge">0 mÃ³dulos</div>
    <svg id="stage" aria-label="tablero"></svg>
  </main>
</div>
<script>
{% raw %}
// =====================
// CONFIG & STATE
// =====================
const CELL = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cell')) || 64;
const COLS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols')) || 22;
const ROWS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows')) || 12;
const PAD  = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--pad'))  || 16;

/** @typedef {{id:string,type:string,label:string,src:string,x:number,y:number}} Node */
/** @type {Node[]} */
let nodes = [];
let selectedId = null;
let draggingId = null; // node.id cuando arrastramos un existente
let ghost = null; // {type,label,src,x,y} cuando arrastramos desde paleta

const stage = document.getElementById('stage');
const palette = document.getElementById('palette');
const badge = document.getElementById('badge');
{% endraw %}
</script>
</body>
</html>
``` 
